---
icon: edit
date: 2022-09-28
order: 20220928
sticky: false
star: false
category:
  - 每日一点小收获
tag:
  - C++
---

Volatile 使用方法

<!-- more -->

# 2022-09-28 volatile

## volatile

Here we will see what is the meaning of volatile qualifier in C++. The volatile qualifier is applied to a variable when we declare it. It is used to tell the compiler, that the value may change at any time. These are some properties of volatile.

- The volatile keyword cannot remove the memory assignment.
- It cannot cache the variables in register.
- The value cannot change in order of assignment.

Let us see, how we can use the volatile keyword.

```cpp
volatile int a;
int volatile a;
```

Here these two declarations are correct. Like other datatypes, we can use volatile pointers, structures, unions etc. The volatile structures and unions can be volatile itself, and their member variables can also be of type volatile.

The volatile is used in different places. For memory mapped peripheral registers, some global variables, that are accessed by some other functions or interrupt service routines, or in some multi-threaded applications, the volatile can be used.

Example

```cpp
int main (){
  int value;
    value++;
}

int main (){
  volatile int value;
  value++;
}
```

There are two blocks of code. In the first block the volatile keyword is not present. So for the first case, the variable will be copied from memory to CPU register, then the operations are performed. In the second case the volatile is present. So in this case the variable will not be copied from memory to registers.

文章链接： https://www.tutorialspoint.com/what-is-volatile-keyword-in-cplusplus

## volatile 和 atomic<>的区别

volatile 仅仅是阻止了编译器的顺序优化，但是依然有可能被硬件层面优化。如果要两个层面优化都阻止，需要使用 atomic

两种优化分别是

- compiler - compiler can reorder / delay / cache variables in registers
- hardware - CPU can reorder read/write as long as the end result should be the same

参考文章： https://yizhang82.dev/atomic-vs-volatile-x86
